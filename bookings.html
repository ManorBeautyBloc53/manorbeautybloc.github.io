<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Bloc Bookings | Manor Beauty Bloc OS</title>

    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600&family=Playfair+Display:ital,wght@0,600;1,600&display=swap" rel="stylesheet">

    <style>
        :root {
            --cream: #FDF6F0;
            --rose-beige: #E6C9B6;
            --black: #000000;
            --rose-gold: #C49B75;
            --white: #ffffff;
            --success: #2d5a2d;
        }

        /* Base Styles */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Montserrat', sans-serif; background-color: var(--cream); color: var(--black); line-height: 1.6; overflow-x: hidden; }
        h1, h2, h3 { font-family: 'Playfair Display', serif; font-weight: 600; }
        .container { max-width: 1100px; margin: 0 auto; padding: 0 20px; }
        .section-title { text-align: center; font-size: 2.8rem; margin-bottom: 50px; }
        .subtitle { display: block; color: var(--rose-gold); text-transform: uppercase; letter-spacing: 4px; font-size: 0.8rem; margin-bottom: 15px; text-align: center; }

        /* Hero */
        .hero { height: 100vh; background: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url('https://images.unsplash.com/photo-1560066984-138dadb4c035?auto=format&fit=crop&w=1600&q=80') center/cover no-repeat; display: flex; align-items: center; justify-content: center; text-align: center; color: white; }
        .hero h1 { font-size: 4rem; margin-bottom: 1rem; }

        /* Buttons & UI Elements */
        .btn-primary { background-color: var(--rose-gold); color: white; padding: 18px 40px; text-decoration: none; border-radius: 50px; transition: 0.3s; display: inline-block; border: none; cursor: pointer; font-weight: 600; text-transform: uppercase; font-size: 0.8rem; letter-spacing: 1px; }
        .btn-primary:hover { background-color: var(--black); transform: translateY(-3px); }
        .hidden { display: none; }

        /* Services Menu */
        .menu-section { padding: 100px 0; background-color: var(--white); }
        .menu-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 60px; }
        .menu-item { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 20px; }
        .menu-item::after { content: ""; flex: 1; border-bottom: 1px dotted var(--rose-beige); margin: 0 15px; }
        .price { color: var(--rose-gold); font-family: 'Playfair Display', serif; font-weight: 600; }

        /* Stylist Portal (The OS Hub) */
        .portal-section { background-color: #f9f9f9; padding: 100px 0; border-top: 1px solid var(--rose-beige); }
        .portal-box { background: var(--white); padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .admin-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 30px; }
        .admin-card { background: var(--cream); padding: 20px; border-radius: 12px; border-top: 4px solid var(--black); }
        .chair { padding: 12px; background: white; margin-bottom: 10px; border-radius: 8px; border: 1px solid #ddd; display: flex; justify-content: space-between; }
        .chair.occupied { border-color: var(--rose-gold); background: #fffaf5; color: var(--rose-gold); font-weight: 600; }
        .ai-brain-btn { background: var(--black); color: var(--rose-gold); border: 1px solid var(--rose-gold); padding: 8px 15px; border-radius: 5px; cursor: pointer; float: right; }
        .status-badge { display: inline-block; font-size: 0.7rem; background: #e0f0e0; color: var(--success); padding: 4px 10px; border-radius: 4px; margin-bottom: 10px; }

        /* Floating Elements */
        .whatsapp-float { position: fixed; width: 60px; height: 60px; bottom: 30px; right: 30px; background-color: var(--black); border-radius: 50px; display: flex; align-items: center; justify-content: center; z-index: 1000; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(196, 155, 117, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(196, 155, 117, 0); } 100% { box-shadow: 0 0 0 0 rgba(196, 155, 117, 0); } }

        /* Animations */
        .reveal { opacity: 0; transform: translateY(30px); transition: 1s ease; }
        .reveal.active { opacity: 1; transform: translateY(0); }

        @media (max-width: 768px) { .admin-grid { grid-template-columns: 1fr; } .menu-grid { grid-template-columns: 1fr; } }

        /* Booking Form (Phase 5) */
        .booking-section { padding: 100px 0; background: var(--white); border-top: 1px solid var(--rose-beige); }
        .booking-box { background: var(--cream); padding: 35px; border-radius: 20px; border: 1px solid var(--rose-beige); box-shadow: 0 10px 30px rgba(0,0,0,0.04); max-width: 760px; margin: 0 auto; }
        .booking-form { display: grid; grid-template-columns: 1fr 1fr; gap: 18px; margin-top: 20px; }
        .booking-form .full { grid-column: 1 / -1; }
        .booking-form input, .booking-form select, .booking-form textarea {
            width: 100%; padding: 14px; border-radius: 10px; border: 1px solid var(--rose-beige); background: var(--white);
            font-family: 'Montserrat', sans-serif;
        }
        .booking-form textarea { min-height: 110px; resize: vertical; }
        .form-note { font-size: 0.85rem; opacity: 0.7; margin-top: 10px; }
        .form-success { margin-top: 15px; color: var(--success); font-weight: 600; }
        .form-error { margin-top: 15px; color: crimson; font-weight: 600; }
        .mini-check { display:flex; gap:10px; align-items:flex-start; }
        .mini-check input { width:auto; margin-top: 4px; }
        @media (max-width: 768px) { .booking-form { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <header class="hero">
        <div class="container">
            <span class="subtitle" style="color: white;">Welcome to</span>
            <h1>The Bloc Bookings</h1>
            <p style="letter-spacing: 5px; margin-bottom: 35px; text-transform: uppercase;">Where Luxury Meets Glow</p>
            <a href="#booking" class="btn-primary">Book Your Appointment</a>
        </div>
    </header>

    <section class="menu-section" id="menu">
        <div class="container">
            <span class="subtitle">Services We Offer</span>
            <h2 class="section-title">The Hair Menu</h2>
            <div class="menu-grid">
                <div class="menu-category reveal">
                    <h3>Natural Hair & Braids</h3>
                    <div class="menu-item"><span>Silk Press & Trim</span><span class="price">From $85</span></div>
                    <div class="menu-item"><span>Knotless Braids</span><span class="price">From $180</span></div>
                    <div class="menu-item"><span>Kids Braids (Under 12)</span><span class="price">From $85</span></div>
                </div>
                <div class="menu-category reveal">
                    <h3>Locs & Barbering</h3>
                    <div class="menu-item"><span>Loc Re-twist & Style</span><span class="price">From $95</span></div>
                    <div class="menu-item"><span>Signature Fade</span><span class="price">From $45</span></div>
                    <div class="menu-item"><span>Full Service Grooming</span><span class="price">From $65</span></div>
                </div>
            </div>
        </div>
    </section>

    <section class="portal-section reveal" id="admin">
        <div class="container">
            <span class="subtitle">System Administration</span>
            <h2 class="section-title">Resolution Hub</h2>

            <div class="portal-box" id="portal-login">
                <h3>Logic Validation Access</h3>
                <p style="margin-bottom: 20px;">Enter Admin PIN to manage chair occupancy and financial splits.</p>
                <input type="password" id="adminPin" placeholder="Enter PIN (Try 1234)" style="padding: 12px; width: 200px; border-radius: 8px; border: 1px solid var(--rose-beige);">
                <button onclick="validatePortal()" class="btn-primary" style="padding: 12px 25px; margin-left: 10px;">Unlock Hub</button>

                <p style="margin-top:18px; font-size:0.9rem; opacity:0.85;">
                    Stylists: <a href="prospect.html" style="color: var(--rose-gold); font-weight:600; text-decoration:none;">Open Prospect Portal</a>
                </p>
            </div>

            <div class="portal-box hidden" id="portal-hub">
                <button class="ai-brain-btn" onclick="runAITriage()">✨ AI Logic Triage</button>
                <div class="status-badge">OS Status: Production-Ready</div>
                <h3>Master Dashboard</h3>

                <div class="admin-grid">
                    <div class="admin-card">
                        <h4>Initial Applicants (Queue)</h4>
                        <div id="applicant-queue" style="margin-top:15px;"></div>
                    </div>
                    <div class="admin-card">
                        <h4>Chair Occupancy Logic</h4>
                        <div id="chair-map" style="margin-top:15px;">
                            <div class="chair" id="c1">Chair 1: <span>Empty</span></div>
                            <div class="chair" id="c2">Chair 2: <span>Empty</span></div>
                            <div class="chair" id="c3">Chair 3: <span>Empty</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

                    <div>
                        <input name="phone" autocomplete="tel" placeholder="Phone number" required />
                    </div>

                    <div>
                        <input name="email" type="email" autocomplete="email" placeholder="Email (optional)" />
                    </div>

                    <div>
                        <select name="service" required>
                            <option value="" selected disabled>Select service</option>
                            <option>Silk Press & Trim</option>
                            <option>Knotless Braids</option>
                            <option>Kids Braids (Under 12)</option>
                            <option>Loc Re-twist & Style</option>
                            <option>Signature Fade</option>
                            <option>Full Service Grooming</option>
                        </select>
                    </div>

                    <div>
                        <input name="preferredDate" type="date" />
                    </div>

                    <!-- Added: preferred time (optional) -->
                    <div>
                        <input name="preferredTime" type="time" />
                    </div>

                    <div class="full">
                        <textarea name="notes" placeholder="Notes (style, inspiration, timing, etc.)"></textarea>
                    </div>

                    <!-- Added: consent + loyalty opt-in (optional) -->
                    <div class="full mini-check">
                        <input type="checkbox" id="consent" name="consent" checked />
                        <label for="consent" style="opacity:0.9;">
                            I consent to be contacted by text/call/email to confirm my appointment request.
                        </label>
                    </div>

                    <div class="full mini-check">
                        <input type="checkbox" id="loyaltyOptIn" name="loyaltyOptIn" />
                        <label for="loyaltyOptIn" style="opacity:0.9;">
                            Send me specials + loyalty offers (optional).
                        </label>
                    </div>

                    <div class="full" style="display:flex; gap: 12px; align-items:center;">
                        <button type="submit" class="btn-primary" id="reserveSubmitBtn">Submit Request</button>
                        <span id="reserveStatus" class="form-success hidden">Submitted!</span>
                    </div>

                    <div class="full form-note">
                        By submitting, you agree we may contact you by phone/text/email to confirm.
                    </div>
                </form>
            </div>
        </div>
    </section>

    <footer style="text-align: center;">
        <div class="container">
            <p>13419 US-290 Bldg 9, Manor, TX 78653 | (512) 215-0566</p>
            <p style="margin-top: 10px; font-size: 0.8rem; opacity: 0.6;">&copy; 2026 Manor Beauty Bloc OS</p>
        </div>
    </footer>

    <a href="https://wa.me/15122150566" class="whatsapp-float">
        <svg width="30" height="30" viewBox="0 0 24 24" fill="white"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L0 24l6.335-1.662c1.72.937 3.659 1.432 5.63 1.433h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
    </a>

    <script>
        /***********************
         * REVEAL + PORTAL (unchanged)
         ***********************/
        const INITIAL_APPLICANTS = [
            { id: 101, name: "Jordan Smith", specialty: "Locs" },
            { id: 102, name: "Casey V.", specialty: "Barber" }
        ];
        let chairs = { c1: null, c2: null, c3: null };

        const obs = new IntersectionObserver((e) => {
            e.forEach(n => { if(n.isIntersecting) n.target.classList.add('active'); });
        }, { threshold: 0.1 });
        document.querySelectorAll('.reveal').forEach(el => obs.observe(el));

        function validatePortal() {
            if(document.getElementById('adminPin').value === "1234") {
                document.getElementById('portal-login').classList.add('hidden');
                document.getElementById('portal-hub').classList.remove('hidden');
                renderQueue();
            } else { alert("Logic Violation: Unauthorized PIN."); }
        }

        function renderQueue() {
            const q = document.getElementById('applicant-queue');
            q.innerHTML = INITIAL_APPLICANTS.map(a => `
                <div style="display:flex; justify-content:space-between; margin-bottom:10px; border-bottom:1px solid #ddd; padding-bottom:5px;">
                    <span>${a.name} (${a.specialty})</span>
                    <button onclick="approveChair('${a.name}')" style="cursor:pointer; color:var(--rose-gold); border:none; background:none; font-weight:600;">Approve</button>
                </div>
            `).join('');
        }

        function approveChair(name) {
            let assigned = false;
            for (let id in chairs) {
                if (chairs[id] === null) {
                    chairs[id] = name;
                    const el = document.getElementById(id);
                    el.classList.add('occupied');
                    el.querySelector('span').innerText = name;
                    assigned = true;
                    alert(`Logic Validation: Chair ${id.slice(1)} assigned to ${name}`);
                    break;
                }
            }
            if (!assigned) alert("STRESS TEST FAILED: All chairs occupied. Occupancy Protection Active.");
        }

        function runAITriage() {
            alert("✨ AI Check: Stress & Logic Validation complete. 60/40 Financial Split Secured.");
        }

        /***********************
         * PHASE 5 — CUSTOMER INTAKE
         * Send directly to Google Apps Script Web App
         *
         * CRITICAL: Use Content-Type text/plain to avoid CORS preflight (OPTIONS)
         ***********************/

        // 1) Paste your Apps Script Web App URL here (ends with /exec)
        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbytkJ6voAQSSUS0_sgwJfpJoirL88W8X6T5mfU0hUADaj0KJRpl0OEXAxK6iHom0Hpm/exec";

        // 2) Paste your SHARED_SECRET value here (must match Script Property SHARED_SECRET)
        const SECRET = "121983Es$06071984Es$";

        async function submitBooking(payload) {
            const url = `${WEB_APP_URL}?path=booking&secret=${encodeURIComponent(SECRET)}`;

            const res = await fetch(url, {
                method: "POST",
                // IMPORTANT: avoids OPTIONS preflight that breaks Apps Script
                headers: { "Content-Type": "text/plain;charset=utf-8" },
                body: JSON.stringify(payload),
                redirect: "follow",
            });

            const text = await res.text();
            let data;
            try { data = JSON.parse(text); }
            catch { data = { ok: false, error: text || "Bad response from server" }; }

            if (!data.ok) throw new Error(data.error || "Failed");
            return data;
        }

        function setReserveStatus_(message, isError) {
            const el = document.getElementById("reserveStatus");
            if (!el) return;
            el.textContent = message;
            el.classList.remove("hidden");
            el.classList.toggle("form-error", !!isError);
            el.classList.toggle("form-success", !isError);
        }

        function setReserveSubmitting_(isSubmitting) {
            const btn = document.getElementById("reserveSubmitBtn");
            if (!btn) return;
            btn.disabled = isSubmitting;
            btn.style.opacity = isSubmitting ? "0.7" : "1";
            btn.textContent = isSubmitting ? "Submitting..." : "Submit Request";
        }

        // Optional: basic phone cleanup
        function normalizePhone_(phone) {
            return String(phone || "").replace(/[^\d+]/g, "").trim();
        }

        document.addEventListener("DOMContentLoaded", () => {
            const form = document.getElementById("reserveForm");
            if (!form) return;

            form.addEventListener("submit", async (e) => {
                e.preventDefault();

                document.getElementById("reserveStatus")?.classList.add("hidden");
                setReserveSubmitting_(true);

                // IMPORTANT: keys must match what your Code.gs expects:
                // clientName, email, phone, serviceName, preferredDate, preferredTime, notes, consent, loyaltyOptIn, source, userAgent
                const payload = {
                    clientName: form.fullName.value.trim(),
                    phone: normalizePhone_(form.phone.value),
                    email: (form.email.value || "").trim(),
                    serviceName: form.service.value,
                    preferredDate: form.preferredDate.value || "",
                    preferredTime: form.preferredTime.value || "",
                    notes: (form.notes.value || "").trim(),
                    consent: !!form.consent.checked,
                    loyaltyOptIn: !!form.loyaltyOptIn.checked,
                    source: "website",
                    userAgent: navigator.userAgent,
                };

                try {
                    await submitBooking(payload);
                    setReserveStatus_("Submitted! We'll reach out shortly.", false);
                    form.reset();
                    // keep consent checked by default after reset (optional)
                    form.consent.checked = true;
                } catch (err) {
                    setReserveStatus_(err && err.message ? err.message : "Error submitting request.", true);
                } finally {
                    setReserveSubmitting_(false);
                }
            });
        });
    </script>
</body>
</html>
